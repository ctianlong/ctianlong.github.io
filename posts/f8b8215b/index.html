<!doctype html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="Java,markdown,html,"><link rel="shortcut icon" type="image/x-icon" href="/aquarius_favicon.ico?v=5.1.0"><meta name="description" content="本文讲解了两种Markdown文档转Html文档的方式，并将其应用到工作API文档书写和发布中，以此实现更简便高效的API文档发布和使用。"><meta name="keywords" content="Java,markdown,html"><meta property="og:type" content="article"><meta property="og:title" content="Markdown转Html应用与实践"><meta property="og:url" content="blog.tongjilab.cn/posts/f8b8215b/index.html"><meta property="og:site_name" content="唯细水静流"><meta property="og:description" content="本文讲解了两种Markdown文档转Html文档的方式，并将其应用到工作API文档书写和发布中，以此实现更简便高效的API文档发布和使用。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="https://static.tongjilab.cn/blog/api文档markdown转html工作流程.png"><meta property="og:image" content="https://static.tongjilab.cn/blog/markdown示例文本.png"><meta property="og:image" content="https://static.tongjilab.cn/blog/image-20220528185031568.png"><meta property="og:updated_time" content="2022-06-02T16:18:48.668Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Markdown转Html应用与实践"><meta name="twitter:description" content="本文讲解了两种Markdown文档转Html文档的方式，并将其应用到工作API文档书写和发布中，以此实现更简便高效的API文档发布和使用。"><meta name="twitter:image" content="https://static.tongjilab.cn/blog/api文档markdown转html工作流程.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{display:"hide"},fancybox:!0,motion:!0,duoshuo:{userId:"undefined",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="blog.tongjilab.cn/posts/f8b8215b/"><title> Markdown转Html应用与实践 | 唯细水静流</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container one-collumn page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">唯细水静流</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">点滴成江海，跬步至千里</h1></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li><li class="menu-item menu-item-music"><a id="audioBtn" style="cursor:pointer"><i class="menu-item-icon fa fa-music fa-fw"></i><br>放松一下</a><audio id="bgMusic" src></audio></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div> <span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="blog.tongjilab.cn/posts/f8b8215b/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="ctianlong"><meta itemprop="description" content><meta itemprop="image" content="https://static.tongjilab.cn/blog/avatar.jfif"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="唯细水静流"> <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="唯细水静流" src></span></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> Markdown转Html应用与实践</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-06-01T00:27:50+08:00">2022-06-01</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span><a href="/posts/f8b8215b/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/posts/f8b8215b/" itemprop="commentCount"></span></a></span> <span class="post-meta-divider">|</span><span class="page-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>本文讲解了两种Markdown文档转Html文档的方式，并将其应用到工作API文档书写和发布中，以此实现更简便高效的API文档发布和使用。</p><a id="more"></a><h2 id="问题背景"><a href="#问题背景" class="headerlink" title="问题背景"></a>问题背景</h2><p>工作项目中经常需要对外提供API接口，并提供对应的接口文档，供调用方阅读使用。</p><p>原先使用Word来书写API文档，线下发送文档给API使用者，这种方式较为不便，每当接口发生改动或新增接口时，都要将更新后的文档再次线下发送给使用者，每次发送都需要人工操作，一旦API接入的使用者数量变多，则通知并发送新文档给每一个使用者将会成为一项耗时且繁琐的工作，并且容易出现发送遗漏，导致调用方未能及时获取新的API信息。</p><p>同时，Word文档的保存与共享也较为不便，不同人手中的文档可能不是同一个版本，想要及时获取最新版的文档需要人工沟通。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>为了更方便地共享和使用API文档，将文档获取转为线上，向API使用者提供统一的文档网址，通过浏览器访问阅读。</p><p>将API文档由原来的Word书写改为Markdown书写，再将Markdown文件转换为Html文档，最后将Html发布到线上地址供访问，同时也可以将Markdown源文件发布到线上地址，供我方技术人员下载，每当需要更新API文档时可在该文件基础上编辑，无需本地保存。</p><p>整个流程如下图所示，技术人员只需将最新的Markdown文件上传，后续流程便会自动化进行，其中最关键的一步是将Markdown文件通过程序自动转换为Html，下一小节将讲述如何将其转换为拥有合适页面样式的Html文档。</p><p><img src="https://static.tongjilab.cn/blog/api文档markdown转html工作流程.png" alt="api文档markdown转html工作流程"></p><h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><p>此处介绍两种Markdown转Html的实现方式。</p><h3 id="第一种方式"><a href="#第一种方式" class="headerlink" title="第一种方式"></a>第一种方式</h3><p>借助Github Markdown API实现，只需通过http接口，直接POST请求调用<code>https://api.github.com/markdown</code>，传入所需转换的Markdown文本，返回结果即为转换后的Html文档，示例如下，更多参数详见参考文档地址：<a href="https://docs.github.com/en/rest/reference/markdown" rel="external nofollow noopener noreferrer" target="_blank">Github Markdown API</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl \</span><br><span class="line">  -X POST \</span><br><span class="line">  -H "Accept: application/vnd.github.v3+json" \</span><br><span class="line">  -d '&#123;"text": "# Markdown Title Example"&#125;'\</span><br><span class="line">  https://api.github.com/markdown</span><br><span class="line">  </span><br><span class="line">&lt;h1&gt;&lt;a id="user-content-markdown-title-example" class="anchor" href="#markdown-title-example" aria-hidden="true"&gt;&lt;span aria-hidden="true" class="octicon octicon-link"&gt;&lt;/span&gt;&lt;/a&gt;Markdown Title Example&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>优点：</p><ul><li><p>第三方接口直接调用，简便快捷。</p></li><li><p>支持gfm风格（GitHub Flavored Markdown），配合gfm风格样式（如：<a href="https://github.com/sindresorhus/github-markdown-css" target="_blank" rel="noopener">https://github.com/sindresorhus/github-markdown-css</a>）可实现代码高亮等特性。</p></li></ul><p>缺点：</p><ul><li><p>不够灵活，完全依赖github第三方实现，无法自定义更多转换设置和细节，如无法在指定标签中加入指定属性。</p></li><li><p>当前接口不支持Toc目录转换。</p></li></ul><h3 id="第二种方式"><a href="#第二种方式" class="headerlink" title="第二种方式"></a>第二种方式</h3><p>使用开源Markdown转换三方库，推荐<code>flexmark-java</code>库，项目中也采用该库实现。</p><p><code>flexmark-java</code>是 CommonMark（spec 0.28）解析器的Java实现，是一款具有源级别AST的CommonMark / Markdown Java解析器。它的优势在于解析速度快，灵活性强，而且能够支持自定义AST，允许对解析过程进行精细控制，内置大量解析器和常用扩展，为解析行为和 HTML 属性样式提供了更多转换设置和选项，如gfm扩展用于支持gfm风格样式，Toc扩展用于创建目录和自定义目录层级等，同时也可以自定义扩展来实现业务需求，例如为标签增加自定义属性等。</p><h4 id="基本使用方法"><a href="#基本使用方法" class="headerlink" title="基本使用方法"></a>基本使用方法</h4><p><code>flexmark-java</code>的使用也很方便，只需简单配置即可满足常规的转换需求，如下代码是项目中的配置。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将入参Markdown文档转换为html文档</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">mdToHtmlForApiDoc</span><span class="params">(String md)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 按需添加扩展</span></span><br><span class="line">	MutableDataSet options = <span class="keyword">new</span> MutableDataSet().set(Parser.EXTENSIONS, Arrays.asList(</span><br><span class="line">			<span class="comment">// 自定义扩展，为&lt;pre&gt;标签添加line-numbers的class，用于prism库代码左侧行号展示</span></span><br><span class="line">			CodePreLineNumbersExtension.create(),</span><br><span class="line">			AutolinkExtension.create(),</span><br><span class="line">			EmojiExtension.create(),</span><br><span class="line">			StrikethroughExtension.create(),</span><br><span class="line">			TaskListExtension.create(),</span><br><span class="line">			TablesExtension.create(),</span><br><span class="line">			TocExtension.create()</span><br><span class="line">	))</span><br><span class="line">			<span class="comment">// set GitHub table parsing options</span></span><br><span class="line">			.set(TablesExtension.WITH_CAPTION, <span class="keyword">false</span>)</span><br><span class="line">			.set(TablesExtension.COLUMN_SPANS, <span class="keyword">false</span>)</span><br><span class="line">			.set(TablesExtension.MIN_HEADER_ROWS, <span class="number">1</span>)</span><br><span class="line">			.set(TablesExtension.MAX_HEADER_ROWS, <span class="number">1</span>)</span><br><span class="line">			.set(TablesExtension.APPEND_MISSING_COLUMNS, <span class="keyword">true</span>)</span><br><span class="line">			.set(TablesExtension.DISCARD_EXTRA_COLUMNS, <span class="keyword">true</span>)</span><br><span class="line">			.set(TablesExtension.HEADER_SEPARATOR_COLUMN_MATCH, <span class="keyword">true</span>)</span><br><span class="line">			<span class="comment">// setup emoji shortcut options</span></span><br><span class="line">			<span class="comment">// uncomment and change to your image directory for emoji images if you have it setup</span></span><br><span class="line"><span class="comment">//				.set(EmojiExtension.ROOT_IMAGE_PATH, emojiInstallDirectory())</span></span><br><span class="line">			.set(EmojiExtension.USE_SHORTCUT_TYPE, EmojiShortcutType.GITHUB)</span><br><span class="line">			.set(EmojiExtension.USE_IMAGE_TYPE, EmojiImageType.IMAGE_ONLY);</span><br><span class="line">	<span class="keyword">return</span> mdToHtml(md, options);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">mdToHtml</span><span class="params">(String md, MutableDataSet options)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// uncomment to convert soft-breaks to hard breaks</span></span><br><span class="line"><span class="comment">//		options.set(HtmlRenderer.SOFT_BREAK, "&lt;br /&gt;\n");</span></span><br><span class="line">	Parser parser = Parser.builder(options).build();</span><br><span class="line">	HtmlRenderer renderer = HtmlRenderer.builder(options).build();</span><br><span class="line">	Document document = parser.parse(md);</span><br><span class="line">	<span class="keyword">return</span> renderer.render(document);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以根据自身需求配置各种预定义的扩展，控制转化过程以此得到想要的html内容与格式，例如<code>TablesExtension</code>用于配置表格参数，<code>TocExtension</code>会解析TOC标识生成目录，其它扩展用法可自行探索，上述代码中的<code>CodePreLineNumbersExtension</code>为自定义扩展，后续会讲到。举例说明实际效果。</p><p>输入示例Markdown文本：</p><p><img src="https://static.tongjilab.cn/blog/markdown示例文本.png" alt="markdown示例文本"></p><p>转换后的html文本：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">"markdown示例文本"</span>&gt;</span>Markdown示例文本<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Markdown是一种轻量级的「标记语言」。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">blockquote</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>引用文本：Markdown is a text formatting syntax inspired<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">blockquote</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">"普通内容"</span>&gt;</span>普通内容<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>读一本好书，就是在和高尚的人谈话。<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> ——歌德<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>雇用制度对工人不利，但工人根本无力摆脱这个制度。<span class="tag">&lt;/<span class="name">em</span>&gt;</span> ——阮一峰<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">"表格"</span>&gt;</span>表格<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">align</span>=<span class="string">"left"</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>工作<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"left"</span>&gt;</span>小可爱<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>18<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>吃可爱多<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"left"</span>&gt;</span>小小勇敢<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span>20<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">td</span> <span class="attr">align</span>=<span class="string">"right"</span>&gt;</span>爬棵勇敢树<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">"代码块"</span>&gt;</span>代码块<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>语言名称支持: <span class="tag">&lt;<span class="name">code</span>&gt;</span>java<span class="tag">&lt;/<span class="name">code</span>&gt;</span>, <span class="tag">&lt;<span class="name">code</span>&gt;</span>python<span class="tag">&lt;/<span class="name">code</span>&gt;</span>, <span class="tag">&lt;<span class="name">code</span>&gt;</span>js<span class="tag">&lt;/<span class="name">code</span>&gt;</span>, <span class="tag">&lt;<span class="name">code</span>&gt;</span>html<span class="tag">&lt;/<span class="name">code</span>&gt;</span>, <span class="tag">&lt;<span class="name">code</span>&gt;</span>bash<span class="tag">&lt;/<span class="name">code</span>&gt;</span>, <span class="tag">&lt;<span class="name">code</span>&gt;</span>json<span class="tag">&lt;/<span class="name">code</span>&gt;</span>, <span class="tag">&lt;<span class="name">code</span>&gt;</span>yml<span class="tag">&lt;/<span class="name">code</span>&gt;</span>, <span class="tag">&lt;<span class="name">code</span>&gt;</span>xml<span class="tag">&lt;/<span class="name">code</span>&gt;</span> ...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pre</span> <span class="attr">class</span>=<span class="string">"line-numbers"</span>&gt;</span><span class="tag">&lt;<span class="name">code</span> <span class="attr">class</span>=<span class="string">"language-java"</span>&gt;</span>public class HelloWorld &#123;</span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    System.out.println(&amp;quot;Hello,World!&amp;quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="完善html文档"><a href="#完善html文档" class="headerlink" title="完善html文档"></a>完善html文档</h4><p>注意，通过<code>flexmark-java</code>转换得到的html文档只包含网页的主体部分，即body标签里的内容，由于没有样式文件配合，还无法呈现美观的显示效果。因此，我们还需在此基础上添加html、head、body等标签，以及引入所需的link、style等样式和脚本文件来完善html文档，使之展示成最终想要的样式。</p><p>此处选择github风格的样式文件，直接引入网上开源的css文件（也可自己写样式）。同时引入<code>prism.js</code>实现代码高亮，最终html内容如下所示，其中<code>&lt;article&gt;</code>标签内填入上一步所得的html文档即可。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>示例标题<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.1.0/github-markdown.min.css"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line">    .markdown-body &#123;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">        min-width: 200px;</span><br><span class="line">        max-width: 980px;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        padding: 45px</span><br><span class="line">    &#125;</span><br><span class="line">    @media(max-width:767px) &#123;</span><br><span class="line">        .markdown-body &#123;</span><br><span class="line">            padding: 15px</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/themes/prism.min.css"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/plugins/line-numbers/prism-line-numbers.min.css"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"markdown-body"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">article</span>&gt;</span></span><br><span class="line">    	！此处替换为上一步转换得到的html文本！</span><br><span class="line">    <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/components/prism-core.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/plugins/autoloader/prism-autoloader.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/plugins/line-numbers/prism-line-numbers.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>最终显示效果如下：</p><p><img src="https://static.tongjilab.cn/blog/image-20220528185031568.png" alt="image-20220528185031568"></p><h4 id="自定义解析扩展"><a href="#自定义解析扩展" class="headerlink" title="自定义解析扩展"></a>自定义解析扩展</h4><p>用<code>prims.js</code>实现代码行号显示时，要求在<code>&lt;pre&gt;</code>标签中包含<code>line-numbers</code>的class属性，即<code>&lt;pre class=&quot;line-numbers&quot;&gt;</code>，原始转换结果并不包含这个，我们通过自定义解析扩展来实现为标签添加自定义属性，即上文讲到的<code>CodePreLineNumbersExtension</code>。</p><p>首先自定义<code>AttributeProvider</code>的实现类<code>CodePreLineNumbersAttributeProvider</code>，代码如下，通过实现<code>AttributeProvider</code>来修改元素是<code>flexmark-java</code>常用的扩展方式之一，常规的为元素添加属性均可通过该方式实现。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CodePreLineNumbersAttributeProvider</span> <span class="keyword">implements</span> <span class="title">AttributeProvider</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAttributes</span><span class="params">(@NotNull Node node, @NotNull AttributablePart part, @NotNull MutableAttributes attributes)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 定位到&lt;pre&gt;标签元素进行修改</span></span><br><span class="line">		<span class="keyword">if</span> (node <span class="keyword">instanceof</span> FencedCodeBlock &amp;&amp; part == AttributablePart.NODE) &#123;</span><br><span class="line">			attributes.addValue(<span class="string">"class"</span>, <span class="string">"line-numbers"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> AttributeProviderFactory <span class="title">Factory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> IndependentAttributeProviderFactory() &#123;</span><br><span class="line">			<span class="meta">@NotNull</span></span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> AttributeProvider <span class="title">apply</span><span class="params">(@NotNull LinkResolverContext context)</span> </span>&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">new</span> CodePreLineNumbersAttributeProvider();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后需要将自定义的<code>AttributeProvider</code>通过<code>HtmlRenderer.Builder.attributeProviderFactory</code>的方式注册到<code>CodePreLineNumbersExtension</code>中即可使用，代码如下。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CodePreLineNumbersExtension</span> <span class="keyword">implements</span> <span class="title">HtmlRenderer</span>.<span class="title">HtmlRendererExtension</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rendererOptions</span><span class="params">(@NotNull MutableDataHolder options)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// add any configuration settings to options you want to apply to everything, here</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extend</span><span class="params">(@NotNull HtmlRenderer.Builder htmlRendererBuilder, @NotNull String rendererType)</span> </span>&#123;</span><br><span class="line">		htmlRendererBuilder.attributeProviderFactory(CodePreLineNumbersAttributeProvider.Factory());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> CodePreLineNumbersExtension <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> CodePreLineNumbersExtension();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>除了本文讲到的方式，将Markdown转换为Html的方式还有很多，众多对比之下，<code>flexmark-java</code>是相对不错且成熟的解决方案，灵活度高，可定制很多转换设置，同时可自定义扩展来增强功能。本文选择该方式来实现API文档Markdown转html并发布到线上，以此实现更简便高效的API文档发布和使用。</p><blockquote class="blockquote-center">-------------本文结束<i class="fa fa-heart"></i> 感谢您的阅读-------------</blockquote></div><div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div></div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="http://static.tongjilab.cn/image/png/wepayQR.png" alt="ctianlong WeChat Pay"><p>微信打赏</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="http://static.tongjilab.cn/image/png/alipayQR.png" alt="ctianlong Alipay"><p>支付宝打赏</p></div></div></div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Java/" rel="tag"># Java</a> <a href="/tags/markdown/" rel="tag"># markdown</a> <a href="/tags/html/" rel="tag"># html</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/b9b384eb/" rel="next" title="延迟加载原理与实现"><i class="fa fa-chevron-left"></i> 延迟加载原理与实现</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div><script src="//unpkg.com/leancloud-storage/dist/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script type="text/javascript">
      var GUEST = ['nick','mail','link'];
      var guest = 'nick,mail,link';
      guest = guest.split(',').filter(item=>{
        return GUEST.indexOf(item)>-1;
      });
      new Valine({
          el: '#comments' ,
          verify: false,
          notify: false,
          appId: 'V40P4Qi6GnLT2rMryWJqzAnI-gzGzoHsz',
          appKey: 'REUILTd7rSiC7VXBd644HEKy',
          placeholder: 'welcome',
          avatar:'retro',
          guest_info:guest,
          pageSize:'10' || 10
      });
    </script></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://static.tongjilab.cn/blog/avatar.jfif" alt="ctianlong"><p class="site-author-name" itemprop="name">ctianlong</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">9</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories"><span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags"><span class="site-state-item-count">11</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ctianlong" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#问题背景"><span class="nav-text">问题背景</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解决方案"><span class="nav-text">解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实现方式"><span class="nav-text">实现方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#第一种方式"><span class="nav-text">第一种方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#第二种方式"><span class="nav-text">第二种方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基本使用方法"><span class="nav-text">基本使用方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#完善html文档"><span class="nav-text">完善html文档</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义解析扩展"><span class="nav-text">自定义解析扩展</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-text">总结</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2019 - <span itemprop="copyrightYear">2022</span><span class="with-love" id="animate"><i class="fa fa-heartbeat"></i></span> <span class="author" itemprop="copyrightHolder"><a href="https://github.com/ctianlong" target="_blank">ctianlong</a></span></div><div> <span><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="external nofollow noopener noreferrer">浙ICP备17004607号</a></span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span><span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path;function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var searchFunc=function(e,c,n){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var t=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),a=document.getElementById(c),r=document.getElementById(n);a.addEventListener("input",function(){var u=0,d='<ul class="search-result-list">',f=this.value.trim().toLowerCase().split(/[\s\-]+/);r.innerHTML="",1<this.value.trim().length&&t.forEach(function(e){var a=!1,r=e.title.trim().toLowerCase(),c=e.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),t=decodeURIComponent(e.url),n=-1,s=-1,o=-1;if(""!=r&&f.forEach(function(e,t){n=r.indexOf(e),s=c.indexOf(e),(0<=n||0<=s)&&(a=!0,0==t&&(o=s))}),a){u+=1,d+="<li><a href='"+t+"' class='search-result-title'>"+r+"</a>";var i=e.content.trim().replace(/<[^>]+>/g,"");if(0<=o){var l=o-20,p=o+80;l<0&&(l=0),0==l&&(p=50),p>i.length&&(p=i.length);var h=i.substring(l,p);f.forEach(function(e){var t=new RegExp(e,"gi");h=h.replace(t,'<b class="search-keyword">'+e+"</b>")}),d+='<p class="search-result">'+h+"...</p>"}d+="</li>"}}),d+="</ul>",0==u&&(d='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==f&&(d='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),r.innerHTML=d}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script type="text/javascript" src="/js/src/music-ctl.js"></script></body></html>